# Библиотека syslib

## syslib содержит:
* Стартфайл sturtup.S
* Функции для работы с прерываниями
* Другие функции

Для использования syslib нужно подключить `"syslib/syslib.h"`
Проект собирать с `-nostarfiles`.

## Описание функций

Функция `init()` может содержать действия для настройки перед началом работы. Вызывается в конце стартфайта, перед переходом на `main()`.

Функция `set_mtvec()` назначает обработчик прерываений: записывает адрес обработчика в mtvec. Вызывается в стартфайле и назначает обработчик `handler()`; может вызываться в коде программы для переназначения обработчика.
Внимание: нужно использовать версию компилятора, которая не игнорирует `__attribute__((interrupt))`.
Пример:
    set_mtvec((void(*)(void))&enother_handler);

Функция `get_interrupt_diag()` вызывается в обработчике прерывания и формирует диагностику на случай исключения: переписывает регистры mcause, mepc, mtval, mie, mip в глобальную структуру interrupt_diag, расположенную в секции .diag_section. Перед записью в структуру производится ее обнуление.

Функция `set_mepc()` назначает новое значение epc, если из обработчика прерывания нужно вернуться в другое место (не в то, на котором возникло прерывание).
Пример:
    set_mepc((void(*)(void))&enother_handler);
